<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undangan Pernikahan Winda & Hendrik</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>


    <style>
        /* Custom Styles */
        body {
            font-family: 'Merriweather', serif;
            background-color: #FDFBF5; /* Krem Gading lebih lembut */
            color: #4A3728; /* Warna teks utama, turunan sogan */
        }

        .font-display {
            font-family: 'Cinzel Decorative', cursive;
        }

        .font-serif-elegant {
            font-family: 'Playfair Display', serif;
        }

        /* Latar belakang dengan motif batik Parang */
        .batik-bg {
            background-image: url('https://www.transparenttextures.com/patterns/batthern.png');
            background-color: #4A3728; /* Sogan - Cokelat Tua */
            background-size: 300px;
            background-attachment: fixed; /* Efek Parallax */
        }

        /* Efek Gulungan Lontar */
        .lontar-scroll {
            background-color: #F5EFE6; /* Warna kertas lontar */
            border: 2px solid #D4AF37; /* Border emas tipis */
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            padding: 2rem 3rem;
            border-radius: 5px;
            position: relative;
        }
        .lontar-scroll::before, .lontar-scroll::after {
            content: '';
            position: absolute;
            left: -15px;
            top: 0;
            width: 15px;
            height: 100%;
            background: #A07C5B; /* Warna kayu penggulung */
            border-radius: 5px 0 0 5px;
            box-shadow: -2px 0 5px rgba(0,0,0,0.2);
        }
        .lontar-scroll::after {
            left: auto;
            right: -15px;
            border-radius: 0 5px 5px 0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
        }
        
        /* Animasi untuk tombol */
        .btn-gold {
            background-color: #D4AF37;
            color: #4A3728;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-gold:hover {
            background-color: #EACD6F;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Gunungan SVG Styling */
        .gunungan-svg {
            fill: #D4AF37; /* Warna Emas */
            filter: drop-shadow(0px 5px 10px rgba(0,0,0,0.4));
        }

        /* Animasi Scroll Fade In */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .animate-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Style untuk Cover/Halaman Pembuka */
        #cover {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 1.5s ease, visibility 1.5s;
        }
        #cover.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        #main-content {
            position: relative;
            z-index: 10;
        }
        #main-content.hidden {
            display: none;
        }

        /* --- STYLING GALERI 2 BARIS --- */
        .carousel-viewport {
            width: 100%;
            overflow: hidden;
            cursor: grab;
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }
        .carousel-viewport.active {
            cursor: grabbing;
        }

        .carousel-track {
            display: flex;
            gap: 1rem; /* Jarak antar foto */
            width: fit-content;
            animation: scroll-left 40s linear infinite;
            user-select: none; /* Mencegah seleksi teks saat menggeser */
        }
        
        .carousel-track.reverse {
            animation-name: scroll-right;
        }
        
        .carousel-track.paused {
            animation-play-state: paused;
        }

        @keyframes scroll-left {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }
        
        @keyframes scroll-right {
            from { transform: translateX(-50%); }
            to { transform: translateX(0); }
        }

        .carousel-img {
            height: 250px; /* Tinggi foto disesuaikan */
            width: auto;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .carousel-img.zoomed {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            z-index: 10;
        }
        
        /* --- EFEK BUNGA BERJATUHAN --- */
        #falling-flowers-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 40; /* Di atas konten tapi di bawah tombol musik */
            pointer-events: none; /* Agar tidak bisa diklik */
        }
        
        /* Spinner untuk Tombol Gemini */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4A3728;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Canvas untuk efek bunga berjatuhan -->
    <canvas id="falling-flowers-canvas"></canvas>

    <!-- Halaman Pembuka (Cover) -->
    <div id="cover" class="batik-bg">
        <div class="text-center text-white p-8 relative z-10">
            <p class="font-serif-elegant text-xl tracking-widest text-gray-200 mb-4">The Wedding Of</p>
            <h1 class="font-display text-6xl md:text-8xl text-yellow-300" style="text-shadow: 2px 2px 5px rgba(0,0,0,0.5);">
                Winda & Hendrik
            </h1>
            <div class="w-24 h-0.5 bg-yellow-400 mx-auto my-8"></div>
            <p class="text-lg text-gray-200 mb-8">Kepada Bapak/Ibu/Saudara/i</p>
            <button id="open-invitation" class="btn-gold py-3 px-8 rounded-full font-bold text-lg font-serif-elegant flex items-center mx-auto gap-2">
                <i data-lucide="mail-open" class="w-5 h-5"></i>
                Buka Undangan
            </button>
        </div>
        <div class="absolute inset-0 bg-black/50"></div>
    </div>

    <!-- Konten Utama (Awalnya tersembunyi) -->
    <div id="main-content" class="hidden">
        <!-- Tombol Musik -->
        <button id="music-toggle" class="fixed bottom-5 right-5 z-50 bg-amber-800 text-yellow-400 p-3 rounded-full shadow-lg focus:outline-none">
            <i data-lucide="music-4" id="music-on-icon" style="display: none;"></i>
            <i data-lucide="volume-x" id="music-off-icon"></i>
        </button>
        <audio id="background-music" loop>
            <source src="https://st2.ezsrv.net/download?sig=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmaWxlUGF0aCI6Ii4vZmlsZXMvMjAyNS82LzgvOS80OC8xOTQ4OWNjNjBkM2JlNzkwMzc0Y2NmZTQubXAzIiwidGl0bGUiOiJLZWJvIEdpcm8ubXAzIiwiaWF0IjoxNzUxOTczNjU1LCJleHAiOjE3NTIwNjAwNTV9.51oAy0Mc_BtjHCDdpj09aUa0zw2OMkxXrt4mNw2MZ-k?download&s=1&v=HuvqYZI49ho&f=mp3&_=0.30874679538205496" type="audio/mpeg">
            Browser Anda tidak mendukung elemen audio.
        </audio>

        <!-- Halaman Utama (Hero Section) -->
        <header class="batik-bg text-center text-white min-h-screen flex flex-col items-center justify-center p-8 relative">
            <div class="absolute inset-0 bg-black/30"></div>
            <div class="relative z-10 animate-on-scroll">
                <p class="text-lg tracking-widest text-gray-200 mb-4">UNDANGAN PERNIKAHAN</p>
                
                <svg class="gunungan-svg w-32 h-32 mx-auto mb-6" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L3.5 10.5L4.5 11.5L12 4L19.5 11.5L20.5 10.5L12 2ZM4.5 13.5V22H19.5V13.5L12 21L4.5 13.5Z"/>
                </svg>

                <h1 class="font-display text-6xl md:text-8xl text-yellow-300" style="text-shadow: 2px 2px 5px rgba(0,0,0,0.5);">
                    Winda & Hendrik
                </h1>
                <div class="w-24 h-0.5 bg-yellow-400 mx-auto my-8"></div>
                <p class="text-xl text-gray-200">Kami mengundang Anda untuk merayakan hari bahagia kami pada:</p>
                <p id="wedding-date" class="font-display text-3xl text-yellow-300 mt-4">Jumat, 29 Agustus 2025</p>
                
                <div id="countdown" class="flex justify-center space-x-4 md:space-x-8 mt-8 text-yellow-300">
                    <div class="text-center"><p id="days" class="text-4xl font-bold">00</p><p class="text-sm">Hari</p></div>
                    <div class="text-center"><p id="hours" class="text-4xl font-bold">00</p><p class="text-sm">Jam</p></div>
                    <div class="text-center"><p id="minutes" class="text-4xl font-bold">00</p><p class="text-sm">Menit</p></div>
                    <div class="text-center"><p id="seconds" class="text-4xl font-bold">00</p><p class="text-sm">Detik</p></div>
                </div>
            </div>
        </header>

        <main class="bg-[#FDFBF5]">
            <section id="pasangan" class="py-20 px-6 text-center animate-on-scroll">
                <h2 class="font-display text-4xl text-amber-900 mb-4">Dengan Memohon Rahmat & Ridho Allah SWT</h2>
                <p class="max-w-3xl mx-auto text-lg text-gray-700">
                    Kami bermaksud menyelenggarakan acara pernikahan putra-putri kami, dan dengan penuh rasa hormat mengundang Bapak/Ibu/Saudara/i untuk memberikan doa restu.
                </p>
                <div class="flex flex-col md:flex-row justify-center items-center gap-12 mt-12 max-w-5xl mx-auto">
                    <div class="w-full md:w-1/2">
                        <!-- FOTO WINDA TELAH DIGANTI -->
                        <img src="[url=https://ibb.co/MyBQ2NC5][img]https://i.ibb.co/JW3gBksF/IMG-5846-copy.jpg[/img][/url]" alt="Foto Winda" class="w-48 h-48 rounded-full mx-auto object-cover border-4 border-yellow-500 shadow-lg">
                        <h3 class="font-display text-4xl text-amber-800 mt-6">Winda Septiawati</h3>
                        <p class="mt-2 text-gray-600">Putri dari Bapak I Gede Sumantra & Ibu Ni Wayan Sari</p>
                    </div>
                    <div class="font-display text-5xl text-yellow-500">&</div>
                    <div class="w-full md:w-1/2">
                        <!-- FOTO HENDRIK TELAH DIGANTI -->
                        <img src="https://drive.google.com/uc?export=view&id=1b8xWyyE0AQCImASr1MMmXof86SPp11w9" alt="Foto Hendrik" class="w-48 h-48 rounded-full mx-auto object-cover border-4 border-yellow-500 shadow-lg">
                        <h3 class="font-display text-4xl text-amber-800 mt-6">Hendrik Salim</h3>
                        <p class="mt-2 text-gray-600">Putra dari Bapak Drs. Bambang Susilo & Ibu Dra. Endang Puspita</p>
                    </div>
                </div>
            </section>

            <section id="kisah" class="py-20 px-6 bg-amber-50 animate-on-scroll">
                <div class="max-w-4xl mx-auto">
                    <div class="lontar-scroll">
                        <h2 class="font-display text-4xl text-amber-900 text-center mb-6">Kisah Kami</h2>
                        <p class="text-gray-700 leading-relaxed text-justify">
                            Berawal dari sebuah pertemuan tak terduga, takdir menuntun kami pada sebuah perjalanan. Canda tawa dan cerita menjadi benang yang merajut hari-hari kami. Melewati berbagai musim, rasa itu tumbuh, mengakar kuat di hati. Kini, dengan restu semesta, kami beranikan diri untuk melangkah ke gerbang baru, menyatukan dua jiwa dalam ikrar suci. Sebuah kisah sederhana yang kami harap akan abadi selamanya.
                        </p>
                    </div>
                </div>
            </section>

            <!-- --- GALERI 2 BARIS BARU --- -->
            <section id="galeri" class="py-20 px-6 text-center animate-on-scroll overflow-hidden space-y-4">
                <h2 class="font-display text-4xl text-amber-900 mb-8">Momen Bahagia Kami</h2>
                <!-- Baris Atas -->
                <div class="carousel-viewport">
                    <div class="carousel-track">
                        <!-- FOTO GALERI ATAS TELAH DIGANTI -->
                        <img src="https://drive.google.com/uc?export=view&id=1sriwFrw-fHM5L5onLFkqgnvdpHk1NsHt" alt="Foto 1" class="carousel-img">
                        <img src="https://drive.google.com/uc?export=view&id=1VoNbvcXncwMGqks7WfH8V1O9Exn_BcRU" alt="Foto 2" class="carousel-img">
                        <img src="https://drive.google.com/uc?export=view&id=1Blb8aWc6_DN82BmfyOS7tMdDLF9-qvu0" alt="Foto 3" class="carousel-img">
                    </div>
                </div>
                <!-- Baris Bawah -->
                <div class="carousel-viewport">
                    <div class="carousel-track reverse">
                        <!-- FOTO GALERI BAWAH TELAH DIGANTI -->
                        <img src="https://drive.google.com/uc?export=view&id=1sjPxu0FktBz5RMVMiq1vWzFdmMbZKaUC" alt="Foto 4" class="carousel-img">
                        <img src="https://drive.google.com/uc?export=view&id=1EpAWBI7YlzZbH4vqN2pquljLAYrdiY5o" alt="Foto 5" class="carousel-img">
                        <img src="https://drive.google.com/uc?export=view&id=1z3NeEMuwsPc-Cr6phTJQaO-0N-GtgwDb" alt="Foto 6" class="carousel-img">
                    </div>
                </div>
            </section>

            <section id="acara" class="py-20 px-6 bg-amber-50 animate-on-scroll">
                <h2 class="font-display text-4xl text-amber-900 text-center mb-12">Waktu & Tempat Acara</h2>
                <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-10">
                    <!-- ALAMAT BARU -->
                    <div class="bg-white p-8 rounded-lg shadow-lg text-center border-t-4 border-yellow-500">
                        <h3 class="font-display text-3xl text-amber-800">Akad Nikah</h3>
                        <div class="w-16 h-0.5 bg-yellow-500 mx-auto my-4"></div>
                        <p class="text-lg font-bold">Jumat, 29 Agustus 2025</p>
                        <p class="text-lg">Pukul 09:00 - 11:00 WIB</p>
                        <p class="mt-4 text-gray-600 font-semibold">Gedung Serbaguna Puspawarman</p>
                        <p class="text-sm text-gray-500">Jl. Puspawarman, Kalijaga, Kec. Harjamukti, Kota Cirebon</p>
                    </div>
                    <!-- ALAMAT BARU -->
                    <div class="bg-white p-8 rounded-lg shadow-lg text-center border-t-4 border-yellow-500">
                        <h3 class="font-display text-3xl text-amber-800">Resepsi</h3>
                        <div class="w-16 h-0.5 bg-yellow-500 mx-auto my-4"></div>
                        <p class="text-lg font-bold">Jumat, 29 Agustus 2025</p>
                        <p class="text-lg">Pukul 19:00 - 21:00 WIB</p>
                        <p class="mt-4 text-gray-600 font-semibold">Gedung Serbaguna Puspawarman</p>
                        <p class="text-sm text-gray-500">Jl. Puspawarman, Kalijaga, Kec. Harjamukti, Kota Cirebon</p>
                    </div>
                </div>
                <!-- PETA BARU -->
                <div class="max-w-6xl mx-auto mt-10 rounded-lg overflow-hidden shadow-xl">
                    <a href="https://maps.app.goo.gl/47atatuKxmcWM3KAA" target="_blank" class="block btn-gold text-center py-3 rounded-t-lg font-bold">Buka di Google Maps</a>
                    <iframe id="map-frame" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3962.339659955325!2d108.5413583749947!3d-6.728946993267191!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e6f1d8665736379%3A0x60f69c07b66236b!2sGedung%20Serbaguna%20Puspawarman!5e0!3m2!1sen!2sid!4v1720436987175!5m2!1sen!2sid" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </section>

            <section id="ucapan" class="py-20 px-6 animate-on-scroll">
                <div class="max-w-3xl mx-auto">
                    <h2 class="font-display text-4xl text-amber-900 text-center mb-4">Buku Tamu & Ucapan</h2>
                    <p class="text-center text-gray-600 mb-10">Kehadiran dan doa restu Anda adalah anugerah terindah bagi kami.</p>
                    <div class="bg-white p-8 rounded-lg shadow-lg border-t-4 border-yellow-500">
                        <form id="rsvp-form">
                            <div class="mb-4"><label for="nama" class="block text-amber-800 font-bold mb-2">Nama Anda</label><input type="text" id="nama" name="nama" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required></div>
                            <div class="mb-4"><label class="block text-amber-800 font-bold mb-2">Konfirmasi Kehadiran</label><select id="kehadiran" name="kehadiran" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"><option value="Hadir">Ya, saya akan hadir</option><option value="Tidak Hadir">Maaf, tidak bisa hadir</option></select></div>
                            <div class="mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <label for="ucapan-teks" class="block text-amber-800 font-bold">Pesan & Ucapan Selamat</label>
                                    <button type="button" id="generate-wish-btn" class="text-xs bg-yellow-200 text-amber-900 py-1 px-2 rounded-md hover:bg-yellow-300 transition-colors flex items-center gap-1">
                                        ✨ Bantu Tulis Ucapan
                                        <div id="gemini-spinner" class="spinner hidden"></div>
                                    </button>
                                </div>
                                <textarea id="ucapan-teks" name="ucapan" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required></textarea>
                            </div>
                            <button type="submit" class="btn-gold w-full py-3 rounded-full font-bold">Kirim Ucapan</button>
                        </form>
                    </div>
                    <!-- Daftar ucapan akan diisi oleh Firebase -->
                    <div id="guestbook-entries" class="mt-10 space-y-4">
                        <!-- Contoh entri, akan dihapus dan diganti data asli -->
                        <p class="text-center text-gray-500">Memuat ucapan...</p>
                    </div>
                </div>
            </section>

            <section id="hadiah" class="py-20 px-6 bg-amber-50 text-center animate-on-scroll">
                <h2 class="font-display text-4xl text-amber-900 mb-4">Tanda Kasih</h2>
                <p class="max-w-2xl mx-auto text-gray-600 mb-10">Doa restu Anda merupakan karunia yang sangat berarti bagi kami. Namun, jika memberi adalah ungkapan tanda kasih, Anda dapat memberi kado secara digital.</p>
                <div class="flex flex-col md:flex-row justify-center gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-lg w-full md:w-80"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bank_Central_Asia.svg/2560px-Bank_Central_Asia.svg.png" alt="Logo BCA" class="h-8 mx-auto mb-4"><p class="text-lg font-semibold">a/n Winda Septiawati</p><p id="bca-rek" class="text-2xl font-bold my-2 text-amber-800">123 456 7890</p><button class="btn-gold py-2 px-5 rounded-full text-sm" onclick="copyToClipboard('bca-rek', this)">Salin No. Rek.</button></div>
                    <div class="bg-white p-6 rounded-lg shadow-lg w-full md:w-80"><img src="https://upload.wikimedia.org/wikipedia/id/thumb/5/55/BNI_logo.svg/1280px-BNI_logo.svg.png" alt="Logo BNI" class="h-8 mx-auto mb-4"><p class="text-lg font-semibold">a/n Hendrik Salim</p><p id="bni-rek" class="text-2xl font-bold my-2 text-amber-800">098 765 4321</p><button class="btn-gold py-2 px-5 rounded-full text-sm" onclick="copyToClipboard('bni-rek', this)">Salin No. Rek.</button></div>
                </div>
            </section>
        </main>

        <footer class="batik-bg py-12 text-center text-white">
            <div class="relative z-10 animate-on-scroll">
                <p class="text-lg text-gray-200">Merupakan suatu kehormatan dan kebahagiaan bagi kami apabila Bapak/Ibu/Saudara/i berkenan hadir untuk memberikan doa restu.</p>
                <p class="font-display text-4xl text-yellow-300 mt-6">Winda & Hendrik</p>
                <p class="text-sm text-gray-400 mt-8">Wassalamualaikum Warahmatullahi Wabarakatuh</p>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import fungsi yang diperlukan dari SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', () => {

            // --- Konfigurasi dan Inisialisasi Firebase ---
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-wedding-app';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);

            // --- Logika Halaman Pembuka (Cover) ---
            const openButton = document.getElementById('open-invitation');
            const cover = document.getElementById('cover');
            const mainContent = document.getElementById('main-content');
            const audio = document.getElementById('background-music');
            const musicToggle = document.getElementById('music-toggle');
            const musicOnIcon = document.getElementById('music-on-icon');
            const musicOffIcon = document.getElementById('music-off-icon');

            openButton.addEventListener('click', () => {
                cover.style.pointerEvents = 'none';
                cover.classList.add('hidden');
                mainContent.classList.remove('hidden');
                
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        musicOnIcon.style.display = 'block';
                        musicOffIcon.style.display = 'none';
                    }).catch(error => {
                        console.log("Autoplay dicegah oleh browser.");
                        musicOnIcon.style.display = 'none';
                        musicOffIcon.style.display = 'block';
                    });
                }

                initScrollAnimations();
                initCarousel();
                initFallingFlowers();
            });

            // --- Kontrol Musik ---
            musicToggle.addEventListener('click', () => {
                if (audio.paused) {
                    audio.play().then(() => {
                        musicOnIcon.style.display = 'block';
                        musicOffIcon.style.display = 'none';
                    });
                } else {
                    audio.pause();
                    musicOnIcon.style.display = 'none';
                    musicOffIcon.style.display = 'block';
                }
            });


            // --- Countdown Timer ---
            const countdownElement = document.getElementById('countdown');
            if (countdownElement) {
                const weddingDateStr = document.getElementById('wedding-date').innerText;
                const dateParts = weddingDateStr.split(', ')[1].split(' ');
                const day = parseInt(dateParts[0]);
                const monthName = dateParts[1];
                const year = parseInt(dateParts[2]);
                const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
                const month = months.indexOf(monthName);
                const countDownDate = new Date(year, month, day, 0, 0, 0).getTime();

                const x = setInterval(function() {
                    const now = new Date().getTime();
                    const distance = countDownDate - now;
                    document.getElementById("days").innerText = Math.floor(distance / (1000 * 60 * 60 * 24)).toString().padStart(2, '0');
                    document.getElementById("hours").innerText = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
                    document.getElementById("minutes").innerText = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
                    document.getElementById("seconds").innerText = Math.floor((distance % (1000 * 60)) / 1000).toString().padStart(2, '0');
                    if (distance < 0) {
                        clearInterval(x);
                        countdownElement.innerHTML = "<p class='text-2xl'>Acara Telah Berlangsung</p>";
                    }
                }, 1000);
            }

            // --- Animasi Scroll ---
            function initScrollAnimations() {
                const animatedElements = document.querySelectorAll('.animate-on-scroll');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('is-visible');
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.1 });

                animatedElements.forEach(el => {
                    observer.observe(el);
                });
            }

            // --- FUNGSI GALERI INTERAKTIF ---
            function initCarousel() {
                const carousels = document.querySelectorAll('.carousel-viewport');
                carousels.forEach(carousel => {
                    const carouselTrack = carousel.querySelector('.carousel-track');
                    if (!carouselTrack) return;

                    const originalContent = carouselTrack.innerHTML;
                    carouselTrack.innerHTML += originalContent;

                    const allImages = carouselTrack.querySelectorAll('.carousel-img');
                    allImages.forEach(img => { img.style.pointerEvents = 'auto'; });

                    let currentlyZoomed = null;

                    allImages.forEach(img => {
                        img.addEventListener('click', (e) => {
                            if (isDragging) return; 
                            e.stopPropagation();
                            if (img.classList.contains('zoomed')) {
                                img.classList.remove('zoomed');
                                carouselTrack.classList.remove('paused');
                                currentlyZoomed = null;
                            } else {
                                if (currentlyZoomed) {
                                    currentlyZoomed.classList.remove('zoomed');
                                }
                                img.classList.add('zoomed');
                                carouselTrack.classList.add('paused');
                                currentlyZoomed = img;
                            }
                        });
                    });

                    let isDown = false;
                    let isDragging = false;
                    let startX;
                    let scrollLeft;

                    const startDrag = (e) => {
                        isDown = true;
                        isDragging = false;
                        carouselTrack.classList.add('paused');
                        carousel.classList.add('active');
                        startX = (e.pageX || e.touches[0].pageX) - carousel.offsetLeft;
                        scrollLeft = carousel.scrollLeft;
                    };

                    const endDrag = () => {
                        isDown = false;
                        carousel.classList.remove('active');
                        if (!currentlyZoomed) {
                            carouselTrack.classList.remove('paused');
                        }
                        setTimeout(() => isDragging = false, 50);
                    };

                    const doDrag = (e) => {
                        if (!isDown) return;
                        e.preventDefault();
                        isDragging = true;
                        const x = (e.pageX || e.touches[0].pageX) - carousel.offsetLeft;
                        const walk = (x - startX) * 2;
                        carousel.scrollLeft = scrollLeft - walk;
                    };

                    carousel.addEventListener('mousedown', startDrag);
                    carousel.addEventListener('touchstart', startDrag);
                    carousel.addEventListener('mouseup', endDrag);
                    carousel.addEventListener('mouseleave', endDrag);
                    carousel.addEventListener('touchend', endDrag);
                    carousel.addEventListener('mousemove', doDrag);
                    carousel.addEventListener('touchmove', doDrag);
                });
            }

            // --- FUNGSI EFEK BUNGA BERJATUHAN ---
            function initFallingFlowers() {
                const canvas = document.getElementById('falling-flowers-canvas');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');

                let width = canvas.width = window.innerWidth;
                let height = canvas.height = window.innerHeight;

                window.addEventListener('resize', function() {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                });

                const petals = [];
                const numPetals = 15; // Intensitas dikurangi
                const petalShapes = ['🌸', '🤍', '🍃']; // Kombinasi kelopak

                class Petal {
                    constructor() {
                        this.x = Math.random() * width;
                        this.y = Math.random() * -height;
                        this.size = 10 + Math.random() * 10;
                        this.shape = petalShapes[Math.floor(Math.random() * petalShapes.length)];
                        this.opacity = 0.3 + Math.random() * 0.4; // Opacity dikurangi
                        this.xSpeed = Math.random() - 0.5;
                        this.ySpeed = 0.5 + Math.random();
                        this.rotation = Math.random() * Math.PI * 2;
                        this.rotationSpeed = (Math.random() - 0.5) * 0.02;
                    }

                    draw() {
                        ctx.globalAlpha = this.opacity;
                        ctx.font = this.size + 'px serif';
                        ctx.save();
                        ctx.translate(this.x, this.y);
                        ctx.rotate(this.rotation);
                        ctx.fillText(this.shape, -this.size / 2, this.size / 2);
                        ctx.restore();
                    }

                    animate() {
                        this.x += this.xSpeed;
                        this.y += this.ySpeed;
                        this.rotation += this.rotationSpeed;

                        if (this.y > height + this.size) {
                            this.x = Math.random() * width;
                            this.y = -this.size;
                        }
                        this.draw();
                    }
                }

                function createPetals() {
                    for (let i = 0; i < numPetals; i++) {
                        petals.push(new Petal());
                    }
                }

                function animationLoop() {
                    ctx.clearRect(0, 0, width, height);
                    petals.forEach(petal => petal.animate());
                    requestAnimationFrame(animationLoop);
                }

                createPetals();
                animationLoop();
            }

            // --- FUNGSI BUKU TAMU (FIRESTORE & GEMINI) ---
            const rsvpForm = document.getElementById('rsvp-form');
            const guestbookEntries = document.getElementById('guestbook-entries');
            const generateWishBtn = document.getElementById('generate-wish-btn');
            const ucapanTextarea = document.getElementById('ucapan-teks');
            const geminiSpinner = document.getElementById('gemini-spinner');
            const guestbookCollectionPath = `/artifacts/${appId}/public/data/guestbook`;
            
            // Fungsi untuk memanggil Gemini API
            generateWishBtn.addEventListener('click', async () => {
                generateWishBtn.disabled = true;
                geminiSpinner.classList.remove('hidden');
                
                const prompt = "Tuliskan ucapan pernikahan yang singkat, indah, dan menyentuh untuk pasangan bernama Winda dan Hendrik.";
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; // Disediakan oleh environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        ucapanTextarea.value = text.trim();
                    } else {
                        ucapanTextarea.value = "Selamat berbahagia, Winda & Hendrik! Semoga cinta kalian abadi selamanya.";
                        console.error("Struktur respons Gemini tidak terduga:", result);
                    }
                } catch (error) {
                    console.error("Gagal memanggil Gemini API:", error);
                    ucapanTextarea.value = "Selamat menempuh hidup baru untuk Winda dan Hendrik!";
                } finally {
                    generateWishBtn.disabled = false;
                    geminiSpinner.classList.add('hidden');
                }
            });

            // Fungsi untuk menampilkan ucapan dari Firestore
            function renderMessages() {
                const q = query(collection(db, guestbookCollectionPath));
                onSnapshot(q, (snapshot) => {
                    const messages = [];
                    snapshot.forEach((doc) => {
                        messages.push(doc.data());
                    });

                    messages.sort((a, b) => {
                        const timeA = a.createdAt ? a.createdAt.toMillis() : 0;
                        const timeB = b.createdAt ? b.createdAt.toMillis() : 0;
                        return timeB - timeA;
                    });
                    
                    guestbookEntries.innerHTML = '';
                    if (messages.length === 0) {
                        guestbookEntries.innerHTML = '<p class="text-center text-gray-500">Jadilah yang pertama mengirim ucapan!</p>';
                    } else {
                        messages.forEach(data => {
                            const newEntry = document.createElement('div');
                            newEntry.className = 'bg-white p-4 rounded-lg shadow-sm border-l-4 border-yellow-500';
                            newEntry.innerHTML = `
                                <p class="font-bold text-amber-800">${data.name || 'Anonim'}</p>
                                <p class="text-gray-600 italic">"${data.message || ''}"</p>
                                <p class="text-xs text-right text-gray-400 mt-2">${data.createdAt ? formatTimestamp(data.createdAt.toDate()) : 'Baru saja'}</p>
                            `;
                            guestbookEntries.appendChild(newEntry);
                        });
                    }
                });
            }
            
            // Fungsi untuk mengirim ucapan ke Firestore
            rsvpForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const namaInput = document.getElementById('nama');
                const ucapanInput = document.getElementById('ucapan-teks');
                const submitButton = rsvpForm.querySelector('button[type="submit"]');

                if (!namaInput.value.trim() || !ucapanInput.value.trim()) {
                    alert("Nama dan ucapan tidak boleh kosong.");
                    return;
                }
                
                submitButton.disabled = true;
                submitButton.textContent = 'Mengirim...';

                try {
                    await addDoc(collection(db, guestbookCollectionPath), {
                        name: namaInput.value,
                        message: ucapanInput.value,
                        createdAt: serverTimestamp()
                    });
                    rsvpForm.reset();
                } catch (error) {
                    console.error("Gagal mengirim ucapan: ", error);
                    alert("Gagal mengirim ucapan, silakan coba lagi.");
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Kirim Ucapan';
                }
            });

            // Otentikasi dan muat data
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log("User signed in:", user.uid);
                    renderMessages();
                }
            });

            async function authAndLoad() {
                try {
                    const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                    if (token) {
                        await signInWithCustomToken(auth, token);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Otentikasi gagal:", error);
                }
            }
            
            authAndLoad();

            // Initialize Lucide Icons
            lucide.createIcons();
        });

        // --- Fungsi Global ---
        function copyToClipboard(elementId, button) {
            const textToCopy = document.getElementById(elementId).innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            const originalText = button.innerText;
            button.innerText = 'Tersalin!';
            setTimeout(() => {
                button.innerText = originalText;
            }, 2000);
        }
        
        function formatTimestamp(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " tahun lalu";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " bulan lalu";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " hari lalu";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " jam lalu";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " menit lalu";
            return "Baru saja";
        }
    </script>
</body>
</html>
